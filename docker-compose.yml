version: "3.7"

services:
  camunda-bpm:
    build:
      context: .
      args:
        - http_proxy
        - https_proxy
        - no_proxy
    environment:
      - CAMUNDA_DB_PASSWORD=camunda
      - CAMUNDA_DB_HOST=host.docker.internal
      - CAMUNDA_DB_PORT=5898
      - CLIENT_ID
      - CLIENT_SECRET
      - ISSUER_URI
      - SPRING_FLYWAY_ENABLED=false
      - CAMUNDA_BPM_DATABASE_SCHEMA_UPDATE=true
      - SPRING_PROFILES_ACTIVE=default
      - JAVA_TOOL_OPTIONS=-XX:InitialRAMPercentage=30.0 -XX:MaxRAMPercentage=65.0 -XX:MinRAMPercentage=30.0  -javaagent:/opt/app/applicationinsights-agent-3.4.18.jar -Dfile.encoding=UTF-8 -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005
    ports:
      - "8999:8999"
      - "5005:5005"
    depends_on:
      - camunda-bpm-database
  camunda-bpm-database:
    build:
      context: docker/database
    environment:
      - POSTGRES_PASSWORD=postgres
    ports:
      - 5898:5432
    volumes:
      - camunda-bpm:/var/lib/postgresql/data

volumes:
  camunda-bpm:
